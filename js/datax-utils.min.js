(function(){"use strict";angular.module("dataxUtils",[]).service("dxHttp",function($http,t,$compile){this.getData=function(e,n){var o=t.defer();return $http.get(e).then(function(t){null!=n&&null!=n&&t.data.status&&"failure"==t.data.status&&n.show(n.alert().clickOutsideToClose(!0).textContent("错误:"+t.data.data).ok("确定")),o.resolve(t)},function(t){null!=n&&null!=n&&n.show(n.alert().clickOutsideToClose(!0).textContent("服务器内部错误，请联系管理员！").ok("确定")),o.reject(t)}),o.promise},this.postData=function(e,n,o){var r=t.defer();return $http.post(e,n,{headers:{"X-CSRFToken":getCookie("csrftoken"),"Content-Type":"application/json"}}).then(function(t){null!=o&&null!=o&&t.data.status&&"failure"==t.data.status&&o.show(o.alert().clickOutsideToClose(!0).textContent("错误:"+t.data.data).ok("确定")),r.resolve(t)},function(t){null!=o&&null!=o&&o.show(o.alert().clickOutsideToClose(!0).textContent("服务器内部错误，请联系管理员！").ok("确定")),r.reject(t)}),r.promise}}).factory("reg",function(){return{isNumber:function(t){var e=/^\d*$/;return e.test(t)}}}).factory("dxCalendar",function(){return{yearsOfDecade:function(t){var e=Number((t+"").substring(0,3)+0)-1,n=_.times(4,_.stubArray),o=0;return n.forEach(function(t){for(var n=0;n<3;n++){var r={year:e+o};0==o&&(r.last=!0),11==o&&(r.next=!0),t.push(r),o+=1}}),n},daysOfMonth:function(t){for(var vm={calendarArr:[]},e=0;e<6;e++)vm.calendarArr.push(_.times(7,_.stubArray));return vm.currentMonth=moment(t),vm.lastMonth=moment(t).subtract(1,"month"),vm.nextMonth=moment(t).subtract(-1,"month"),vm.daysInMonth=vm.currentMonth.daysInMonth(),vm.weekOfMonthFirstDay=vm.currentMonth.date(1).isoWeekday(),vm.daysInLastMonth=vm.lastMonth.daysInMonth(),vm.lastMonthIndex=0,vm.startIndedx=1,vm.nextMonthIndex=1,vm.calendarArr.forEach(function(t,e){t.forEach(function(t,e){vm.lastMonthIndex<vm.weekOfMonthFirstDay-1?(t.push({week:e+1,day:vm.daysInLastMonth-(vm.weekOfMonthFirstDay-e-2),month:vm.lastMonth.month()+1,year:vm.lastMonth.year(),isLastmonth:!0}),vm.lastMonthIndex+=1):(vm.startIndedx<=vm.daysInMonth?t.push({week:e+1,day:vm.startIndedx,month:vm.currentMonth.month()+1,year:vm.currentMonth.year()}):(t.push({week:e+1,day:vm.nextMonthIndex,month:vm.nextMonth.month()+1,year:vm.nextMonth.year(),isNextmonth:!0}),vm.nextMonthIndex+=1),vm.startIndedx+=1)})}),vm.calendarArr}}}).factory("dom",function(){return{offset:function(t){var e={top:0,left:0},n=t&&t.ownerDocument;if(n)return void 0!==t.getBoundingClientRect&&(e=t.getBoundingClientRect()),{top:e.top+(window.pageYOffset||n.documentElement.scrollTop||n.body.scrollTop)-(n.documentElement.clientTop||0),left:e.left+(window.pageXOffset||n.documentElement.scrollLeft||n.body.scrollLeft)-(n.documentElement.clientLeft||0),offsetWidth:t.offsetWidth||e.right-e.left,offsetHeight:t.offsetHeight||e.bottom-e.top}},calcPosition:function(t,e,n){var o=this.offset(t),r=this.offset(e);return console.log(o.top,r.top),{left:o.left-r.left+"px",top:o.top-r.top+o.offsetHeight+"px"}},openOverlayBackdrop:function(t,e){var n=document.createElement("div");n.className="datax-overlay-backdrop",document.body.appendChild(n),n.addEventListener("click",function(){document.body.removeChild(n),e.forEach(function(t){t.remove()})})}}}).filter("formatText",function(){return function(t,e){try{return e&&"finance"==e&&angular.isNumber(t)&&(t>100||t<-100)?financeFormat(t):e&&"date"==e&&isNotNull(t)?"string"==typeof t?moment(new Date(t)).format("YYYY-MM-DD"):moment(t).format("YYYY-MM-DD"):t}catch(e){return t}}})})();